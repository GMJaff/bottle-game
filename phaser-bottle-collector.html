<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Bottle Collector (Phaser)</title>
  <style>
    html,body { height:100%; margin:0; background:#b3e5fc; }
    #game-container { width:100%; height:100vh; overflow:hidden; }
    /* Simple mobile control buttons */
    .controls { position: fixed; left: 0; right:0; bottom: 12px; display:flex; justify-content:center; gap:12px; pointer-events:none; }
    .btn { pointer-events:auto; user-select:none; width:72px; height:72px; border-radius:12px; background:rgba(0,0,0,0.25); display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; font-size:22px; }
    .btn.small { width:56px; height:56px; font-size:18px; }
    #info { position:fixed; left:12px; top:12px; background:rgba(255,255,255,0.9); padding:8px 10px; border-radius:8px; font-family:sans-serif; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>
  <div id="game-container"></div>
  <div id="info">Bottles: <span id="score">0</span>/<span id="total">0</span></div>

  <!-- Mobile controls -->
  <div class="controls" aria-hidden="true">
    <div style="display:flex;gap:8px;align-items:center;">
      <div id="leftBtn" class="btn">◀</div>
      <div id="rightBtn" class="btn">▶</div>
      <div id="jumpBtn" class="btn small">▲</div>
    </div>
  </div>

<script>
class MainScene extends Phaser.Scene {
  constructor(){ super('MainScene'); }
  preload() {
    // No external assets — we create simple textures at runtime
  }
  create() {
    // world
    this.physics.world.setBounds(0, 0, 1200, 700);
    // create small textures
    this.makePlayerTexture();
    this.makeBottleTextures();
    this.makeTrashTexture();

    // background color handled by CSS

    // platforms group (static)
    this.platforms = this.physics.add.staticGroup();
    // ground
    this.platforms.create(600, 680, null).setDisplaySize(1200, 40).refreshBody().setTint(0x8d6e63);
    // some floating platforms
    const plats = [
      [250, 540, 240, 20], [450, 430, 240, 20], [700, 480, 220, 20], [900, 580, 220, 20], [200, 350, 140, 20], [520, 300, 140,20]
    ];
    plats.forEach(p=>{
      const plat = this.add.rectangle(p[0], p[1], p[2], p[3], 0x8d6e63);
      this.physics.add.existing(plat, true);
      this.platforms.add(plat);
    });

    // player
    this.player = this.physics.add.sprite(80, 600, 'player');
    this.player.setCollideWorldBounds(true);
    this.player.setBounce(0);
    this.player.body.setSize(36,48).setOffset(2,2);

    // collisions
    this.physics.add.collider(this.player, this.platforms);

    // bottles (collectibles)
    this.bottles = this.physics.add.group({ allowGravity: false });
    const bottlePositions = [
      [300,500,'plastic'], [500,380,'glass'], [720,440,'plastic'], [940,540,'glass'], [240,260,'plastic'], [560,220,'glass'], [420,380,'plastic']
    ];
    bottlePositions.forEach(p=>{
      const b = this.bottles.create(p[0], p[1], p[2]);
      b.type = p[2];
      b.setSize(20,28).setOffset(0,0);
    });

    // trash can at the far right
    this.trash = this.physics.add.staticSprite(1100, 620, 'trash');
    this.trash.setSize(60,80).setOffset(0,0);

    // overlaps
    this.physics.add.overlap(this.player, this.bottles, this.collectBottle, null, this);
    this.physics.add.overlap(this.player, this.trash, this.tryFinish, null, this);

    // camera
    this.cameras.main.setBounds(0,0,1200,700);
    this.cameras.main.startFollow(this.player, true, 0.08, 0.08);

    // controls
    this.cursors = this.input.keyboard.createCursorKeys();
    this.WASD = this.input.keyboard.addKeys('W,A,S,D');

    this.isLeft = false; this.isRight = false; this.isJump = false;

    // mobile buttons
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const jumpBtn = document.getElementById('jumpBtn');
    const makeDownUp = (el, onDown, onUp)=>{
      el.addEventListener('pointerdown', e=>{ e.preventDefault(); onDown(); });
      el.addEventListener('pointerup', e=>{ e.preventDefault(); onUp(); });
      el.addEventListener('pointerout', e=>{ e.preventDefault(); onUp(); });
      el.addEventListener('pointercancel', e=>{ e.preventDefault(); onUp(); });
    };
    makeDownUp(leftBtn, ()=>this.isLeft=true, ()=>this.isLeft=false);
    makeDownUp(rightBtn, ()=>this.isRight=true, ()=>this.isRight=false);
    makeDownUp(jumpBtn, ()=>this.isJump=true, ()=>this.isJump=false);

    // UI counts
    this.collected = 0;
    document.getElementById('total').textContent = this.bottles.getChildren().length;
    document.getElementById('score').textContent = this.collected;

    // small instructions for first-time players
    this.showedHint=false;
  }

  update() {
    const onGround = this.player.body.blocked.down || this.player.body.touching.down;
    // horizontal
    let vx = 0;
    if (this.cursors.left.isDown || this.WASD.A.isDown || this.isLeft) vx = -180;
    if (this.cursors.right.isDown || this.WASD.D.isDown || this.isRight) vx = 180;
    this.player.setVelocityX(vx);
    // jump
    const jumpPressed = Phaser.Input.Keyboard.JustDown(this.cursors.up) || Phaser.Input.Keyboard.JustDown(this.WASD.W) || this.isJump;
    if (jumpPressed && onGround) {
      this.player.setVelocityY(-420);
      this.isJump=false; // consume
    }

    // small idle animation (tilt)
    if (vx < 0) this.player.setAngle(-6); else if (vx>0) this.player.setAngle(6); else this.player.setAngle(0);

    // hint
    if (!this.showedHint && (vx!==0 || !onGround)){
      this.showedHint=true;
    }
  }

  collectBottle(player, bottle){
    bottle.disableBody(true,true);
    this.collected += 1;
    document.getElementById('score').textContent = this.collected;
    // small sound or particle could be added
  }

  tryFinish(player, trash){
    if (this.collected === this.bottles.getChildren().length) {
      this.showWin();
    } else {
      this.showNeedAll();
    }
  }

  showWin(){
    this.scene.pause();
    const d = document.createElement('div');
    d.style = 'position:fixed;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.4);font-family:sans-serif;';
    d.innerHTML = `<div style="background:white;padding:26px;border-radius:12px;text-align:center;max-width:90%;"><h2>Thank you!</h2><p>You recycled all bottles. Great job! ♻</p><button id=restart>Play again</button></div>`;
    document.body.appendChild(d);
    document.getElementById('restart').addEventListener('click', ()=>{ d.remove(); this.scene.restart(); });
  }

  showNeedAll(){
    // small popup
    const txt = this.add.text(this.player.x, this.player.y - 80, 'Collect all bottles first!', { font:'18px sans-serif', backgroundColor:'rgba(255,255,255,0.9)', padding: {x:8,y:6} });
    txt.setDepth(9999);
    this.time.delayedCall(1200, ()=>{ txt.destroy(); });
  }

  // textures
  makePlayerTexture(){
    const g = this.make.graphics({ x:0, y:0, add:false });
    g.fillStyle(0x0b67c2, 1);
    g.fillRoundedRect(0,0,40,50,6);
    g.fillStyle(0xffffff,1);
    g.fillCircle(12,15,4);
    g.fillCircle(28,15,4);
    g.generateTexture('player', 40,50);
    g.destroy();
  }

  makeBottleTextures(){
    // plastic (green)
    const g1 = this.make.graphics({ add:false });
    g1.fillStyle(0x009900,1);
    g1.fillRect(0,6,20,28);
    g1.fillRect(8,0,4,6);
    g1.generateTexture('plastic', 20,34);
    g1.destroy();
    // glass (clear-ish)
    const g2 = this.make.graphics({ add:false });
    g2.fillStyle(0xc8dfff,1);
    g2.fillRect(0,6,20,28);
    g2.fillRect(8,0,4,6);
    g2.generateTexture('glass', 20,34);
    g2.destroy();
  }

  makeTrashTexture(){
    const g = this.make.graphics({ add:false });
    g.fillStyle(0x808080,1);
    g.fillRect(0,0,60,80);
    g.fillStyle(0x000000,1);
    g.fillRect(-5,0,70,10);
    // recycle symbol simple
    g.fillStyle(0x00aa00,1);
    g.fillTriangle(20,28,30,20,40,28);
    g.fillTriangle(28,34,34,26,40,34);
    g.generateTexture('trash', 60,80);
    g.destroy();
  }
}

const config = {
  type: Phaser.AUTO,
  parent: 'game-container',
  width: 800,
  height: 600,
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH,
  },
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 900 }, debug: false }
  },
  scene: [MainScene]
};

const game = new Phaser.Game(config);

// Prevent scrolling on mobile when touching controls
['touchstart','touchmove','touchend'].forEach(ev=>document.addEventListener(ev, e=>{ if (e.target.closest('.btn')) e.preventDefault(); }, { passive:false }));
</script>
</body>
</html>
